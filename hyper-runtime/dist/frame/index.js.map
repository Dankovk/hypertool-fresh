{
  "version": 3,
  "sources": ["../src/frame/cssBridge.ts", "../src/frame/controlsBridge.ts", "../src/frame/exportBridge.ts", "../src/frame/dependencyManager.ts", "../src/frame/utils/dom.ts", "../src/frame/runtime.ts", "../src/frame/index.ts"],
  "sourcesContent": [
    "const CLONE_ATTRIBUTE = 'data-hyper-frame-clone';\nconst SUPPORTED_NODE_NAMES = new Set(['STYLE', 'LINK']);\n\ninterface CssBridgeOptions {\n  sourceDocument?: Document | null;\n  targetDocument?: Document | null;\n  mirror?: boolean;\n}\n\ntype NodeMapping = WeakMap<Node, Node>;\n\nexport class CssBridge {\n  private source: Document | null;\n  private target: Document | null;\n  private observer: MutationObserver | null = null;\n  private nodeMap: NodeMapping = new WeakMap();\n  private active = false;\n\n  constructor(options: CssBridgeOptions = {}) {\n    this.source = options.sourceDocument ?? (typeof window !== 'undefined' ? window.parent?.document ?? null : null);\n    this.target = options.targetDocument ?? (typeof document !== 'undefined' ? document : null);\n    this.active = Boolean(options.mirror ?? true);\n  }\n\n  start() {\n    if (!this.active) return;\n    if (!this.source || !this.target) {\n      console.warn('[hyper-frame] Unable to mirror CSS â€“ missing source or target document.');\n      return;\n    }\n\n    this.cleanupPreviousClones();\n    this.syncAll();\n    this.attachObserver();\n  }\n\n  stop() {\n    this.observer?.disconnect();\n    this.observer = null;\n    this.nodeMap = new WeakMap();\n    this.cleanupPreviousClones();\n  }\n\n  private cleanupPreviousClones() {\n    if (!this.target) return;\n    this.target\n      .querySelectorAll(`[${CLONE_ATTRIBUTE}=\"true\"]`)\n      .forEach((node) => node.parentNode?.removeChild(node));\n  }\n\n  private syncAll() {\n    if (!this.source || !this.target) return;\n    const head = this.source.head;\n    const nodes = Array.from(head.children).filter((node) => SUPPORTED_NODE_NAMES.has(node.nodeName));\n\n    nodes.forEach((node) => {\n      const clone = this.cloneNode(node);\n      if (!clone) return;\n      this.target?.head.appendChild(clone);\n      this.nodeMap.set(node, clone);\n    });\n  }\n\n  private attachObserver() {\n    if (!this.source || !this.target) return;\n    if (this.observer) return;\n\n    this.observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        switch (mutation.type) {\n          case 'childList':\n            this.handleChildListMutation(mutation);\n            break;\n          case 'characterData':\n            this.handleCharacterDataMutation(mutation);\n            break;\n          case 'attributes':\n            this.handleAttributeMutation(mutation);\n            break;\n        }\n      });\n    });\n\n    this.observer.observe(this.source.head, {\n      childList: true,\n      subtree: true,\n      characterData: true,\n      attributes: true,\n    });\n  }\n\n  private handleChildListMutation(mutation: MutationRecord) {\n    if (!this.target) return;\n\n    mutation.removedNodes.forEach((node) => {\n      const mapped = this.nodeMap.get(node);\n      if (mapped && mapped.parentNode) {\n        mapped.parentNode.removeChild(mapped);\n        this.nodeMap.delete(node);\n      }\n    });\n\n    mutation.addedNodes.forEach((node) => {\n      if (!(node instanceof HTMLElement)) return;\n      if (!SUPPORTED_NODE_NAMES.has(node.nodeName)) return;\n\n      const clone = this.cloneNode(node);\n      if (!clone) return;\n\n      const reference = mutation.nextSibling ? this.nodeMap.get(mutation.nextSibling) : null;\n      if (reference && reference.parentNode) {\n        reference.parentNode.insertBefore(clone, reference);\n      } else {\n        this.target?.head.appendChild(clone);\n      }\n\n      this.nodeMap.set(node, clone);\n    });\n  }\n\n  private handleCharacterDataMutation(mutation: MutationRecord) {\n    const targetNode = mutation.target;\n    const parent = targetNode.parentNode;\n    if (!parent) return;\n    const mappedParent = this.nodeMap.get(parent);\n    if (!mappedParent) return;\n\n    mappedParent.textContent = parent.textContent;\n  }\n\n  private handleAttributeMutation(mutation: MutationRecord) {\n    const target = mutation.target as Element;\n    const mapped = this.nodeMap.get(target);\n    if (!mapped || !(mapped instanceof Element)) return;\n\n    if (mutation.attributeName) {\n      const value = target.getAttribute(mutation.attributeName);\n      if (value === null) {\n        mapped.removeAttribute(mutation.attributeName);\n      } else {\n        mapped.setAttribute(mutation.attributeName, value);\n      }\n    }\n  }\n\n  private cloneNode(node: Node): HTMLElement | null {\n    if (!(node instanceof HTMLElement)) return null;\n    if (!SUPPORTED_NODE_NAMES.has(node.nodeName)) return null;\n\n    const clone = node.cloneNode(true) as HTMLElement;\n    clone.setAttribute(CLONE_ATTRIBUTE, 'true');\n    return clone;\n  }\n}\n",
    "import type {\n  ControlDefinitions,\n  ControlPanelOptions,\n  ControlChangePayload,\n  SandboxContext,\n} from './types';\n\ninterface HypertoolControlsApi {\n  createControlPanel: (\n    definitions: ControlDefinitions,\n    options: {\n      title?: string;\n      position?: string;\n      expanded?: boolean;\n      container?: HTMLElement | string | null;\n      onChange?: (params: Record<string, any>, context: any) => void;\n    },\n  ) => {\n    params: Record<string, any>;\n    dispose: () => void;\n  } & Record<string, any>;\n}\n\nexport interface ControlsBridgeInitOptions {\n  definitions: ControlDefinitions;\n  options?: ControlPanelOptions;\n  context: SandboxContext;\n  onControlChange?: (change: ControlChangePayload) => void;\n}\n\nexport class ControlsBridge {\n  private controlsApi: HypertoolControlsApi;\n\n  constructor() {\n    this.controlsApi = this.resolveControlsApi();\n  }\n\n  private resolveControlsApi(): HypertoolControlsApi {\n    if (typeof window === 'undefined') {\n      throw new Error('[hyper-frame] window is not available');\n    }\n    const hyperWindow = window as unknown as { hypertoolControls?: HypertoolControlsApi };\n    if (!hyperWindow.hypertoolControls) {\n      throw new Error('[hyper-frame] hypertool controls are not available on window');\n    }\n    return hyperWindow.hypertoolControls;\n  }\n\n  init(options: ControlsBridgeInitOptions) {\n    const panelOptions = options.options || {};\n    const controls = this.controlsApi.createControlPanel(options.definitions, {\n      title: panelOptions.title,\n      position: panelOptions.position,\n      expanded: panelOptions.expanded,\n      container: panelOptions.container,\n      onChange: (params: Record<string, any>, changeContext: any) => {\n        const change: ControlChangePayload = {\n          key: changeContext.key,\n          value: changeContext.value,\n          event: changeContext.event,\n        };\n\n        options.onControlChange?.(change);\n\n        if (typeof panelOptions.onChange === 'function') {\n          panelOptions.onChange(change, options.context);\n        }\n      },\n    });\n\n    return controls;\n  }\n}\n",
    "import type {\n  SandboxCaptureFn,\n  SandboxCaptureResult,\n  SandboxExportsApi,\n  SandboxImageCaptureHandler,\n  SandboxVideoCaptureHandler,\n} from './types';\n\ninterface ExportBridgeOptions {\n  container: HTMLElement;\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n  filename?: string;\n}\n\ninterface NormalizedImageCapture {\n  capture: SandboxCaptureFn;\n  filename?: string;\n  mimeType?: string;\n}\n\ninterface NormalizedVideoCapture {\n  requestStream: () => Promise<MediaStream> | MediaStream;\n  filename?: string;\n  mimeType?: string;\n  bitsPerSecond?: number;\n  timeSlice?: number;\n}\n\nexport class ExportBridge {\n  private container: HTMLElement;\n  private position: ExportBridgeOptions['position'];\n  private filename: string;\n  private root: HTMLDivElement | null = null;\n  private imageButton: HTMLButtonElement | null = null;\n  private videoButton: HTMLButtonElement | null = null;\n  private statusLabel: HTMLSpanElement | null = null;\n  private statusTimeout: number | null = null;\n  private userImageCapture: NormalizedImageCapture | null = null;\n  private userVideoCapture: NormalizedVideoCapture | null = null;\n  private defaultCanvasCaptureEnabled = false;\n  private recording = false;\n  private recorder: MediaRecorder | null = null;\n  private recordedChunks: Blob[] = [];\n\n  constructor(options: ExportBridgeOptions) {\n    this.container = options.container;\n    this.position = options.position;\n    this.filename = options.filename ?? 'hyperframe-export';\n    this.mount();\n  }\n\n  private mount() {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    const root = document.createElement('div');\n    root.className = 'hyper-frame-export-widget';\n    root.dataset.hyperFrame = 'export-widget';\n    Object.assign(root.style, {\n      position: 'fixed',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: '0.25rem',\n      padding: '0.5rem 0.75rem',\n      borderRadius: '0.75rem',\n      background: 'rgba(15, 23, 42, 0.85)',\n      color: '#f8fafc',\n      fontFamily: 'Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont',\n      fontSize: '12px',\n      lineHeight: '16px',\n      boxShadow: '0 20px 40px rgba(15, 23, 42, 0.3)',\n      zIndex: '2147483646',\n      pointerEvents: 'auto',\n      backdropFilter: 'blur(8px)',\n    } as CSSStyleDeclaration);\n\n    const controls = document.createElement('div');\n    controls.style.display = 'flex';\n    controls.style.flexDirection = 'row';\n    controls.style.alignItems = 'center';\n    controls.style.justifyContent = 'space-between';\n    controls.style.gap = '0.5rem';\n\n    const imageButton = document.createElement('button');\n    imageButton.type = 'button';\n    imageButton.textContent = 'Capture PNG';\n    imageButton.style.flex = '1 1 auto';\n    imageButton.style.padding = '0.35rem 0.6rem';\n    imageButton.style.border = '0';\n    imageButton.style.borderRadius = '0.5rem';\n    imageButton.style.cursor = 'pointer';\n    imageButton.style.background = 'rgba(94, 234, 212, 0.2)';\n    imageButton.style.color = '#5eead4';\n    imageButton.style.fontWeight = '600';\n\n    const videoButton = document.createElement('button');\n    videoButton.type = 'button';\n    videoButton.textContent = 'Record Video';\n    videoButton.style.flex = '1 1 auto';\n    videoButton.style.padding = '0.35rem 0.6rem';\n    videoButton.style.border = '0';\n    videoButton.style.borderRadius = '0.5rem';\n    videoButton.style.cursor = 'pointer';\n    videoButton.style.background = 'rgba(129, 140, 248, 0.2)';\n    videoButton.style.color = '#a5b4fc';\n    videoButton.style.fontWeight = '600';\n\n    imageButton.addEventListener('click', () => this.handleImageCapture(), { passive: true });\n    videoButton.addEventListener('click', () => this.toggleRecording(), { passive: true });\n\n    const status = document.createElement('span');\n    status.style.display = 'block';\n    status.style.color = '#e2e8f0';\n    status.style.opacity = '0.8';\n    status.style.minHeight = '16px';\n\n    controls.appendChild(imageButton);\n    controls.appendChild(videoButton);\n    root.appendChild(controls);\n    root.appendChild(status);\n\n    this.root = root;\n    this.imageButton = imageButton;\n    this.videoButton = videoButton;\n    this.statusLabel = status;\n\n    this.applyPosition();\n    document.body.appendChild(root);\n    this.updateButtonStates();\n  }\n\n  private applyPosition() {\n    if (!this.root) return;\n\n    const position = this.position ?? 'bottom-right';\n    const offsets: Record<string, Partial<CSSStyleDeclaration>> = {\n      'bottom-right': { bottom: '1rem', right: '1rem', top: '', left: '' },\n      'bottom-left': { bottom: '1rem', left: '1rem', top: '', right: '' },\n      'top-right': { top: '1rem', right: '1rem', bottom: '', left: '' },\n      'top-left': { top: '1rem', left: '1rem', bottom: '', right: '' },\n    };\n\n    const styles = offsets[position];\n    Object.assign(this.root.style, styles);\n  }\n\n  private setStatus(message: string, tone: 'default' | 'error' | 'success' = 'default') {\n    if (!this.statusLabel) return;\n\n    if (this.statusTimeout) {\n      window.clearTimeout(this.statusTimeout);\n      this.statusTimeout = null;\n    }\n\n    this.statusLabel.textContent = message;\n\n    switch (tone) {\n      case 'error':\n        this.statusLabel.style.color = '#fca5a5';\n        break;\n      case 'success':\n        this.statusLabel.style.color = '#bbf7d0';\n        break;\n      default:\n        this.statusLabel.style.color = '#e2e8f0';\n    }\n\n    if (message) {\n      this.statusTimeout = window.setTimeout(() => {\n        if (this.statusLabel) {\n          this.statusLabel.textContent = '';\n          this.statusLabel.style.color = '#e2e8f0';\n        }\n        this.statusTimeout = null;\n      }, 4000);\n    }\n  }\n\n  private updateButtonStates() {\n    if (this.imageButton) {\n      this.imageButton.disabled = !this.getActiveImageCapture();\n      this.imageButton.style.opacity = this.imageButton.disabled ? '0.6' : '1';\n    }\n\n    if (this.videoButton) {\n      const hasVideo = Boolean(this.getActiveVideoCapture());\n      this.videoButton.disabled = !hasVideo;\n      this.videoButton.style.opacity = hasVideo ? '1' : '0.6';\n    }\n  }\n\n  private normalizeImageCapture(\n    handler: SandboxImageCaptureHandler | SandboxCaptureFn | null,\n  ): NormalizedImageCapture | null {\n    if (!handler) return null;\n\n    if (typeof handler === 'function') {\n      return { capture: handler };\n    }\n\n    return {\n      capture: handler.capture,\n      filename: handler.filename,\n      mimeType: handler.mimeType,\n    };\n  }\n\n  private normalizeVideoCapture(handler: SandboxVideoCaptureHandler | null): NormalizedVideoCapture | null {\n    if (!handler) return null;\n\n    return {\n      requestStream: handler.requestStream,\n      filename: handler.filename,\n      mimeType: handler.mimeType,\n      bitsPerSecond: handler.bitsPerSecond,\n      timeSlice: handler.timeSlice,\n    };\n  }\n\n  private getActiveImageCapture(): NormalizedImageCapture | null {\n    if (this.userImageCapture) {\n      return this.userImageCapture;\n    }\n    if (this.defaultCanvasCaptureEnabled) {\n      return {\n        capture: () => this.captureCanvasSnapshot(),\n        filename: undefined,\n        mimeType: 'image/png',\n      };\n    }\n    return null;\n  }\n\n  private getActiveVideoCapture(): NormalizedVideoCapture | null {\n    if (this.userVideoCapture) {\n      return this.userVideoCapture;\n    }\n    if (this.defaultCanvasCaptureEnabled) {\n      return {\n        requestStream: () => this.captureCanvasStream(),\n        filename: undefined,\n        mimeType: 'video/webm;codecs=vp9',\n      };\n    }\n    return null;\n  }\n\n  private async captureCanvasSnapshot(): Promise<SandboxCaptureResult> {\n    const canvas = this.container.querySelector('canvas');\n    if (!(canvas instanceof HTMLCanvasElement)) {\n      throw new Error('No canvas element available for capture.');\n    }\n\n    return new Promise<Blob | null>((resolve, reject) => {\n      canvas.toBlob((blob) => {\n        if (blob) {\n          resolve(blob);\n        } else {\n          reject(new Error('Canvas capture returned an empty blob.'));\n        }\n      });\n    });\n  }\n\n  private async captureCanvasStream(): Promise<MediaStream> {\n    const canvas = this.container.querySelector('canvas');\n    if (!(canvas instanceof HTMLCanvasElement)) {\n      throw new Error('No canvas element available for recording.');\n    }\n    if (typeof canvas.captureStream !== 'function') {\n      throw new Error('Canvas captureStream API is not supported in this browser.');\n    }\n    return canvas.captureStream(60);\n  }\n\n  private async handleImageCapture() {\n    const handler = this.getActiveImageCapture();\n    if (!handler) {\n      this.setStatus('No capture handler available', 'error');\n      return;\n    }\n\n    try {\n      this.setBusy(true, 'image');\n      const result = await handler.capture();\n      const blob = await this.resolveCaptureResult(result, handler.mimeType ?? 'image/png');\n      if (blob) {\n        const filename = handler.filename ?? `${this.filename}.png`;\n        this.downloadBlob(blob, filename);\n        this.setStatus('PNG exported', 'success');\n      }\n    } catch (error) {\n      console.error('[hyper-frame] Failed to capture image', error);\n      this.setStatus((error as Error).message || 'Failed to capture image', 'error');\n    } finally {\n      this.setBusy(false, 'image');\n    }\n  }\n\n  private async toggleRecording() {\n    if (this.recording) {\n      this.stopRecording();\n      return;\n    }\n\n    const handler = this.getActiveVideoCapture();\n    if (!handler) {\n      this.setStatus('No recorder available', 'error');\n      return;\n    }\n\n    if (typeof MediaRecorder === 'undefined') {\n      this.setStatus('MediaRecorder is not supported in this browser', 'error');\n      return;\n    }\n\n    try {\n      const stream = await handler.requestStream();\n      if (!stream) {\n        throw new Error('Recording stream is not available');\n      }\n\n      this.recordedChunks = [];\n      const recorder = new MediaRecorder(stream, {\n        mimeType: handler.mimeType,\n        videoBitsPerSecond: handler.bitsPerSecond,\n      });\n\n      recorder.addEventListener('dataavailable', (event) => {\n        if (event.data?.size) {\n          this.recordedChunks.push(event.data);\n        }\n      });\n\n      recorder.addEventListener('stop', () => {\n        const blob = new Blob(this.recordedChunks, { type: handler.mimeType ?? 'video/webm' });\n        const filename = handler.filename ?? `${this.filename}.webm`;\n        this.downloadBlob(blob, filename);\n        this.setStatus('Recording saved', 'success');\n        stream.getTracks().forEach((track) => track.stop());\n        this.recording = false;\n        this.updateRecordingUi();\n      });\n\n      recorder.start(handler.timeSlice);\n      this.recorder = recorder;\n      this.recording = true;\n      this.setStatus('Recording in progressâ€¦');\n      this.updateRecordingUi();\n    } catch (error) {\n      console.error('[hyper-frame] Failed to start recording', error);\n      this.setStatus((error as Error).message || 'Failed to record video', 'error');\n      this.recording = false;\n      this.recorder = null;\n      this.updateRecordingUi();\n    }\n  }\n\n  private stopRecording() {\n    if (!this.recorder) {\n      return;\n    }\n\n    this.setStatus('Finishing recordingâ€¦');\n    this.recorder.stop();\n    this.recorder = null;\n    this.recording = false;\n    this.updateRecordingUi();\n  }\n\n  private updateRecordingUi() {\n    if (!this.videoButton) return;\n\n    this.videoButton.textContent = this.recording ? 'Stop Recording' : 'Record Video';\n    this.videoButton.style.background = this.recording ? 'rgba(248, 113, 113, 0.25)' : 'rgba(129, 140, 248, 0.2)';\n    this.videoButton.style.color = this.recording ? '#fecaca' : '#a5b4fc';\n  }\n\n  private async resolveCaptureResult(result: SandboxCaptureResult, mimeType: string): Promise<Blob | null> {\n    if (!result) {\n      return null;\n    }\n\n    if (result instanceof Blob) {\n      return result;\n    }\n\n    if (typeof result === 'string') {\n      if (result.startsWith('data:')) {\n        const response = await fetch(result);\n        return await response.blob();\n      }\n      const response = await fetch(result);\n      return await response.blob();\n    }\n\n    if (result instanceof HTMLCanvasElement) {\n      return await new Promise<Blob | null>((resolve, reject) => {\n        result.toBlob((blob) => {\n          if (blob) {\n            resolve(blob);\n          } else {\n            reject(new Error('Canvas export failed.'));\n          }\n        }, mimeType);\n      });\n    }\n\n    if (typeof OffscreenCanvas !== 'undefined' && result instanceof OffscreenCanvas) {\n      const blob = await result.convertToBlob({ type: mimeType });\n      return blob;\n    }\n\n    return null;\n  }\n\n  private downloadBlob(blob: Blob, filename: string) {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    const url = URL.createObjectURL(blob);\n    const anchor = document.createElement('a');\n    anchor.href = url;\n    anchor.download = filename;\n    anchor.rel = 'noopener';\n    anchor.style.display = 'none';\n    document.body.appendChild(anchor);\n    anchor.click();\n    document.body.removeChild(anchor);\n    URL.revokeObjectURL(url);\n  }\n\n  private setBusy(busy: boolean, mode: 'image' | 'video') {\n    const button = mode === 'image' ? this.imageButton : this.videoButton;\n    if (!button) return;\n    button.disabled = busy;\n    button.style.opacity = busy ? '0.6' : '1';\n  }\n\n  setFilename(filename: string) {\n    this.filename = filename;\n  }\n\n  setVisible(visible: boolean) {\n    if (!this.root) return;\n    this.root.style.display = visible ? 'flex' : 'none';\n  }\n\n  registerImageCapture(handler: SandboxImageCaptureHandler | SandboxCaptureFn | null) {\n    this.userImageCapture = this.normalizeImageCapture(handler);\n    this.updateButtonStates();\n  }\n\n  registerVideoCapture(handler: SandboxVideoCaptureHandler | null) {\n    this.userVideoCapture = this.normalizeVideoCapture(handler);\n    this.updateButtonStates();\n  }\n\n  useDefaultCanvasCapture(enable: boolean = true) {\n    this.defaultCanvasCaptureEnabled = enable;\n    this.updateButtonStates();\n  }\n\n  getApi(): SandboxExportsApi {\n    return {\n      registerImageCapture: (handler) => this.registerImageCapture(handler),\n      registerVideoCapture: (handler) => this.registerVideoCapture(handler),\n      setFilename: (filename) => this.setFilename(filename),\n      setVisible: (visible) => this.setVisible(visible),\n      useDefaultCanvasCapture: (enable?: boolean) => this.useDefaultCanvasCapture(enable),\n      destroy: () => this.destroy(),\n    };\n  }\n\n  destroy() {\n    if (this.statusTimeout) {\n      window.clearTimeout(this.statusTimeout);\n      this.statusTimeout = null;\n    }\n\n    if (this.root?.parentNode) {\n      this.root.parentNode.removeChild(this.root);\n    }\n\n    this.root = null;\n    this.imageButton = null;\n    this.videoButton = null;\n    this.statusLabel = null;\n    this.recorder = null;\n    this.recording = false;\n    this.recordedChunks = [];\n  }\n}\n",
    "export type ExternalDependencyType = 'script' | 'style';\n\nexport interface ExternalDependency {\n  type: ExternalDependencyType;\n  url: string;\n  attributes?: Record<string, string>;\n  integrity?: string;\n  crossOrigin?: string;\n}\n\nexport class DependencyManager {\n  private pending: Map<string, Promise<void>> = new Map();\n\n  ensure(dependency: ExternalDependency): Promise<void> {\n    const key = this.createKey(dependency);\n    if (this.pending.has(key)) {\n      return this.pending.get(key)!;\n    }\n\n    const task = this.load(dependency);\n    this.pending.set(key, task);\n    return task;\n  }\n\n  async ensureAll(dependencies: ExternalDependency[] = []): Promise<void> {\n    for (const dependency of dependencies) {\n      await this.ensure(dependency);\n    }\n  }\n\n  private createKey(dependency: ExternalDependency): string {\n    return `${dependency.type}:${dependency.url}`;\n  }\n\n  private load(dependency: ExternalDependency): Promise<void> {\n    switch (dependency.type) {\n      case 'script':\n        return this.injectScript(dependency);\n      case 'style':\n        return this.injectStyle(dependency);\n      default:\n        return Promise.reject(new Error(`[hyper-frame] Unsupported dependency type: ${dependency.type}`));\n    }\n  }\n\n  private injectScript(dependency: ExternalDependency): Promise<void> {\n    if (typeof document === 'undefined') {\n      return Promise.reject(new Error('[hyper-frame] document is not available'));\n    }\n\n    const existing = Array.from(document.querySelectorAll<HTMLScriptElement>('script')).find(\n      (script) => script.src === dependency.url,\n    );\n    if (existing) {\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const script = document.createElement('script');\n      script.src = dependency.url;\n      script.async = true;\n      script.dataset.hyperFrame = 'external';\n\n      if (dependency.integrity) {\n        script.integrity = dependency.integrity;\n      }\n      if (dependency.crossOrigin) {\n        script.crossOrigin = dependency.crossOrigin;\n      }\n      if (dependency.attributes) {\n        Object.entries(dependency.attributes).forEach(([key, value]) => {\n          script.setAttribute(key, value);\n        });\n      }\n\n      script.addEventListener('load', () => resolve(), { once: true });\n      script.addEventListener('error', () => reject(new Error(`[hyper-frame] Failed to load script ${dependency.url}`)), {\n        once: true,\n      });\n\n      document.head.appendChild(script);\n    });\n  }\n\n  private injectStyle(dependency: ExternalDependency): Promise<void> {\n    if (typeof document === 'undefined') {\n      return Promise.reject(new Error('[hyper-frame] document is not available'));\n    }\n\n    const existing = Array.from(document.querySelectorAll<HTMLLinkElement>('link[rel=\"stylesheet\"]')).find(\n      (link) => link.href === dependency.url,\n    );\n    if (existing) {\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const link = document.createElement('link');\n      link.rel = 'stylesheet';\n      link.href = dependency.url;\n      link.dataset.hyperFrame = 'external';\n\n      if (dependency.attributes) {\n        Object.entries(dependency.attributes).forEach(([key, value]) => {\n          link.setAttribute(key, value);\n        });\n      }\n\n      link.addEventListener('load', () => resolve(), { once: true });\n      link.addEventListener('error', () => reject(new Error(`[hyper-frame] Failed to load stylesheet ${dependency.url}`)), {\n        once: true,\n      });\n\n      document.head.appendChild(link);\n    });\n  }\n}\n",
    "export interface ResolvedContainer {\n  element: HTMLElement;\n  createdInternally: boolean;\n}\n\nexport interface ResolveContainerOptions {\n  target?: HTMLElement | string | null;\n  containerClassName?: string;\n  documentRef?: Document;\n}\n\nexport function resolveContainer(options: ResolveContainerOptions = {}): ResolvedContainer {\n  const doc = options.documentRef ?? document;\n  if (!doc) {\n    throw new Error('[hyper-frame] document is not available');\n  }\n\n  const className = options.containerClassName || 'hypertool-sketch';\n  const target = options.target;\n\n  if (target instanceof HTMLElement) {\n    target.classList.add(className);\n    return { element: target, createdInternally: false };\n  }\n\n  if (typeof target === 'string' && target.trim().length > 0) {\n    const node = doc.querySelector<HTMLElement>(target);\n    if (node) {\n      node.classList.add(className);\n      return { element: node, createdInternally: false };\n    }\n    console.warn(`[hyper-frame] Could not find container for selector \"${target}\", creating one instead.`);\n  }\n\n  const container = doc.createElement('div');\n  container.classList.add(className);\n  doc.body.appendChild(container);\n  return { element: container, createdInternally: true };\n}\n",
    "import { CssBridge } from './cssBridge';\nimport { ControlsBridge } from './controlsBridge';\nimport { ExportBridge } from './exportBridge';\nimport { DependencyManager, ExternalDependency } from './dependencyManager';\nimport {\n  HyperFrameRuntimeApi,\n  HyperFrameRuntimeConfig,\n  HyperFrameSandboxHandle,\n  HyperFrameSandboxOptions,\n  SandboxContext,\n  SandboxControlsHandle,\n  SandboxEnvironment,\n} from './types';\nimport { resolveContainer } from './utils/dom';\n\nfunction runCleanups(cleanups: Array<() => void>) {\n  while (cleanups.length > 0) {\n    const cleanup = cleanups.pop();\n    if (cleanup) {\n      try {\n        cleanup();\n      } catch (error) {\n        console.error('[hyper-frame] cleanup failed', error);\n      }\n    }\n  }\n}\n\nexport class HyperFrameRuntime implements HyperFrameRuntimeApi {\n  private dependencyManager = new DependencyManager();\n  private cssBridge: CssBridge | null = null;\n  private config: HyperFrameRuntimeConfig;\n\n  constructor(config: HyperFrameRuntimeConfig = {}) {\n    this.config = config;\n  }\n\n  async ensureDependencies(dependencies: ExternalDependency[] = []): Promise<void> {\n    if (!dependencies.length) {\n      return;\n    }\n\n    await this.dependencyManager.ensureAll(dependencies);\n  }\n\n  mirrorCss(): void {\n    if (this.cssBridge) {\n      return;\n    }\n\n    this.cssBridge = new CssBridge({ mirror: this.config.mirrorCss !== false });\n    this.cssBridge.start();\n  }\n\n  async createSandbox(options: HyperFrameSandboxOptions): Promise<HyperFrameSandboxHandle> {\n    if (options.dependencies?.length) {\n      await this.ensureDependencies(options.dependencies);\n    }\n\n    if (this.config.mirrorCss !== false && options.mirrorCss !== false) {\n      this.mirrorCss();\n    }\n\n    const mount = this.createMount(options.mount);\n    const cleanups: Array<() => void> = [];\n    const pushCleanup = (cleanup: () => void) => {\n      if (typeof cleanup === 'function') {\n        cleanups.push(cleanup);\n      }\n    };\n\n    const exportBridge = new ExportBridge({\n      container: mount.container,\n      position: options.exportWidget?.position,\n      filename: options.exportWidget?.filename,\n    });\n\n    if (options.exportWidget?.enabled === false) {\n      exportBridge.setVisible(false);\n    }\n\n    if (options.exportWidget?.useCanvasCapture !== false) {\n      exportBridge.useDefaultCanvasCapture(true);\n    }\n\n    const environment = this.createEnvironment(pushCleanup);\n\n    const context: SandboxContext = {\n      mount: mount.container,\n      params: {},\n      controls: null,\n      exports: exportBridge.getApi(),\n      runtime: this,\n      environment,\n    };\n\n    let controlsHandle: SandboxControlsHandle | null = null;\n\n    if (options.controls?.definitions) {\n      const controlsBridge = new ControlsBridge();\n      controlsHandle = controlsBridge.init({\n        definitions: options.controls.definitions,\n        options: options.controls.options,\n        context,\n        onControlChange: (change) => {\n          options.controls?.onChange?.(change, context);\n        },\n      }) as SandboxControlsHandle;\n\n      context.controls = controlsHandle;\n      context.params = controlsHandle?.params ?? {};\n\n      pushCleanup(() => {\n        if (!controlsHandle) return;\n        if (typeof controlsHandle.destroy === 'function') {\n          controlsHandle.destroy();\n        } else if (typeof controlsHandle.dispose === 'function') {\n          controlsHandle.dispose();\n        }\n      });\n    }\n\n    pushCleanup(() => exportBridge.destroy());\n    pushCleanup(() => mount.destroy());\n\n    let setupCleanup: void | (() => void);\n    try {\n      setupCleanup = await options.setup(context);\n    } catch (error) {\n      console.error('[hyper-frame] sandbox setup failed', error);\n      runCleanups(cleanups);\n      throw error;\n    }\n\n    if (typeof setupCleanup === 'function') {\n      pushCleanup(() => {\n        try {\n          setupCleanup?.();\n        } catch (error) {\n          console.error('[hyper-frame] teardown failed', error);\n        }\n      });\n    }\n\n    const handle: HyperFrameSandboxHandle = {\n      container: mount.container,\n      controls: controlsHandle,\n      params: context.params,\n      destroy: () => {\n        runCleanups(cleanups);\n      },\n    };\n\n    return handle;\n  }\n\n  private createEnvironment(pushCleanup: (cleanup: () => void) => void): SandboxEnvironment {\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      throw new Error('[hyper-frame] window or document is not available');\n    }\n\n    return {\n      window,\n      document,\n      addCleanup: (cleanup: () => void) => {\n        if (typeof cleanup === 'function') {\n          pushCleanup(cleanup);\n        }\n      },\n      onResize: (handler: () => void, options?: AddEventListenerOptions) => {\n        window.addEventListener('resize', handler, options);\n        const dispose = () => window.removeEventListener('resize', handler, options);\n        pushCleanup(dispose);\n        return dispose;\n      },\n    };\n  }\n\n  private createMount(options?: HyperFrameSandboxOptions['mount']): { container: HTMLElement; destroy(): void } {\n    const baseOptions = options as any;\n    const resolved = resolveContainer({\n      target: baseOptions?.target,\n      containerClassName: baseOptions?.containerClassName,\n    });\n\n    if (typeof baseOptions?.onReady === 'function') {\n      baseOptions.onReady({ container: resolved.element });\n    }\n\n    return {\n      container: resolved.element,\n      destroy: () => {\n        if (resolved.createdInternally) {\n          resolved.element.remove();\n        }\n      },\n    };\n  }\n}\n",
    "import { HyperFrameRuntime } from './runtime';\nimport type {\n  HyperFrameRuntimeConfig,\n  HyperFrameSandboxHandle,\n  HyperFrameSandboxOptions,\n} from './types';\n\nconst defaultConfig: HyperFrameRuntimeConfig = { mirrorCss: true };\nconst runtime = new HyperFrameRuntime(defaultConfig);\n\nexport { runtime };\n\nexport function configureRuntime(config: HyperFrameRuntimeConfig) {\n  return new HyperFrameRuntime(config);\n}\n\nexport function createSandbox(options: HyperFrameSandboxOptions): Promise<HyperFrameSandboxHandle> {\n  return runtime.createSandbox(options);\n}\n\nexport function ensureDependencies(options?: HyperFrameSandboxOptions['dependencies']) {\n  return runtime.ensureDependencies(options ?? []);\n}\n\nexport function mirrorCss() {\n  runtime.mirrorCss();\n}\n\nexport function attachToWindow() {\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  const hyperWindow = window as unknown as { hyperFrame?: Record<string, any> };\n  const existing = hyperWindow.hyperFrame || {};\n\n  const api = {\n    version: 'universal',\n    runtime,\n    createSandbox,\n    ensureDependencies,\n    mirrorCss,\n  };\n\n  hyperWindow.hyperFrame = { ...existing, ...api };\n}\n\nattachToWindow();\n\nexport type { HyperFrameSandboxOptions, HyperFrameSandboxHandle };\n"
  ],
  "mappings": "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",
  "debugId": "5A47506EB398AD5164756E2164756E21",
  "names": []
}