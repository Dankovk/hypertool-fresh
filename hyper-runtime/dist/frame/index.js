var J=Object.defineProperty;var K=(e,t)=>{for(var n in t)J(e,n,{get:t[n],enumerable:!0,configurable:!0,set:(r)=>t[n]=()=>r})};var de={};K(de,{syncParentStyles:()=>H,startThreeSketchWithRuntime:()=>D,startThreeSketch:()=>G,startP5SketchWithRuntime:()=>b,startP5Sketch:()=>U,startHyperFrame:()=>$,runThreeSketch:()=>L,runP5Sketch:()=>E,mountThreeSketch:()=>w,mountP5Sketch:()=>x,hyperFrameRuntime:()=>ue,createThreeRenderer:()=>F,createP5Renderer:()=>I,createHyperFrameRuntime:()=>O,ParentStyleMirror:()=>R,HyperFrameRuntime:()=>v});function g(e={}){if(typeof document==="undefined")throw new Error("[hyper-frame] document is not available");let t=e.className&&e.className.trim().length>0?e.className:"hyperframe-root",n=e.target;if(n instanceof HTMLElement)return n.classList.add(t),{element:n,createdInternally:!1};if(typeof n==="string"&&n.trim().length>0){let o=document.querySelector(n);if(o)return o.classList.add(t),{element:o,createdInternally:!1};console.warn(`[hyper-frame] Could not find container for selector "${n}", creating one instead.`)}let r=document.createElement("div");return r.classList.add(t),document.body.appendChild(r),{element:r,createdInternally:!0}}class R{targetDocument;observer=null;mappings=new Map;reverseMappings=new Map;anchor;running=!1;sourceDocument=null;sourceIdCounter=0;constructor(e){this.targetDocument=e;this.anchor=e.createComment("hyperframe-style-anchor"),e.head.appendChild(this.anchor)}start(e={}){if(this.running)return;let t=e.sourceDocument??this.tryResolveParentDocument();if(!t){console.warn("[hyper-frame] Unable to access parent document styles.");return}this.sourceDocument=t,this.running=!0,this.copyInitialNodes(t),this.observeSource(t)}stop(){if(this.running=!1,this.observer)this.observer.disconnect(),this.observer=null;this.mappings.clear(),this.reverseMappings.clear(),this.sourceDocument=null}tryResolveParentDocument(){if(typeof window==="undefined")return null;try{if(!window.parent||window.parent===window)return null;return window.parent.document}catch(e){return console.warn("[hyper-frame] Accessing parent document styles is not permitted:",e),null}}copyInitialNodes(e){e.querySelectorAll('link[rel="stylesheet"], style').forEach((n)=>{if(n instanceof HTMLLinkElement||n instanceof HTMLStyleElement)this.ensureMirror(n)})}observeSource(e){if(typeof MutationObserver==="undefined")return;this.observer=new MutationObserver((t)=>{t.forEach((n)=>{if(n.type==="childList")n.addedNodes.forEach((r)=>{if(r instanceof HTMLLinkElement||r instanceof HTMLStyleElement)this.ensureMirror(r)}),n.removedNodes.forEach((r)=>{if(r instanceof HTMLLinkElement||r instanceof HTMLStyleElement)this.removeMirror(r)});if(n.type==="attributes"){let r=n.target;if(r instanceof HTMLLinkElement||r instanceof HTMLStyleElement)this.updateMirror(r)}if(n.type==="characterData"){let r=n.target.parentElement;if(r instanceof HTMLStyleElement)this.updateMirror(r)}})}),this.observer.observe(e.documentElement,{attributes:!0,attributeFilter:["href","media","disabled","integrity","crossorigin","referrerpolicy"],characterData:!0,childList:!0,subtree:!0})}ensureMirror(e){if(this.mappings.get(e)){this.updateMirror(e);return}let n=this.targetDocument.createElement(e.tagName.toLowerCase());n.setAttribute("data-hyperframe-clone","true");let r=this.createSourceId();if(n.setAttribute("data-hyperframe-source",r),this.applyAttributes(e,n),n instanceof HTMLStyleElement&&e instanceof HTMLStyleElement)n.textContent=e.textContent;this.targetDocument.head.insertBefore(n,this.anchor),this.mappings.set(e,{clone:n,sourceId:r}),this.reverseMappings.set(r,n)}removeMirror(e){let t=this.mappings.get(e);if(!t)return;t.clone.remove(),this.mappings.delete(e),this.reverseMappings.delete(t.sourceId)}updateMirror(e){let t=this.mappings.get(e);if(!t){this.ensureMirror(e);return}let{clone:n}=t;if(this.applyAttributes(e,n),n instanceof HTMLStyleElement&&e instanceof HTMLStyleElement){if(n.textContent!==e.textContent)n.textContent=e.textContent}}applyAttributes(e,t){let n=new Set;for(let r=0;r<t.attributes.length;r+=1)n.add(t.attributes[r].name);Array.from(e.attributes).forEach((r)=>{t.setAttribute(r.name,r.value),n.delete(r.name)}),n.forEach((r)=>{if(r.startsWith("data-hyperframe"))return;t.removeAttribute(r)})}createSourceId(){return this.sourceIdCounter+=1,`hf-style-${this.sourceIdCounter}`}}function H(e,t={}){let n=new R(e);return n.start(t),n}function B(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window;if(!e.hypertoolControls)throw new Error("[hyper-frame] hypertool controls are not available on window");return e.hypertoolControls}function Q(e){if(typeof requestAnimationFrame==="function")requestAnimationFrame(e);else setTimeout(e,16)}function V(e,t,n){return new Promise((r,o)=>{let a=0;function i(){a+=1;try{if(e()){r();return}}catch(s){}if(a>=t){o(new Error(`[hyper-frame] Timed out waiting for ${n}`));return}Q(i)}i()})}async function X(e){await V(()=>{try{return B(),!0}catch(t){return!1}},e,"hypertool controls")}async function Y(e,t,n){await X(n);let r=B(),o=e.options||{},a=r.createControlPanel(e.definitions,{title:o.title,position:o.position,expanded:o.expanded,container:o.container,onChange:(i,s)=>{if(t.current){if(t.current.params=i,typeof o.onChange==="function"){let c={key:s.key,value:s.value,event:s.event};try{o.onChange(c,t.current)}catch(u){console.error("[hyper-frame] Error in control change handler:",u)}}}}});return{params:a.params,controls:a,destroy:()=>{if(typeof a.destroy==="function")a.destroy()}}}class v{renderers=new Map;listeners=new Map;options;styleMirror=null;activeSession=null;readyAttempts=600;constructor(e={}){if(this.options=e,typeof window!=="undefined")window.addEventListener("message",(t)=>{this.handleIncomingMessage(t.data)})}registerRenderer(e){this.renderers.set(e.id,e)}unregisterRenderer(e){this.renderers.delete(e)}listRenderers(){return Array.from(this.renderers.keys())}syncParentStyles(e=!1){if(typeof document==="undefined")return;if(this.styleMirror&&!e)return;this.styleMirror=H(document)}onMessage(e,t){if(!this.listeners.has(e))this.listeners.set(e,new Set);return this.listeners.get(e).add(t),()=>{this.listeners.get(e)?.delete(t)}}sendMessage(e,t){if(this.emitLocal(e,t),typeof window!=="undefined"&&window.parent&&window.parent!==window)try{window.parent.postMessage({source:"hyperframe-runtime",type:e,payload:t},"*")}catch(n){console.warn("[hyper-frame] Failed to post message to parent window:",n)}}async start(e){if(typeof window==="undefined"||typeof document==="undefined")throw new Error("[hyper-frame] HyperFrameRuntime can only run in a browser environment");if(this.options.autoSyncParentStyles!==!1||e.syncParentStyles)this.syncParentStyles();let t=e.renderer,n=t?this.renderers.get(t):null;if(t&&!n)throw new Error(`[hyper-frame] Renderer "${t}" is not registered`);let r={target:e.target,className:e.containerClassName||this.options.defaultContainerClassName},o=g(r),a={current:null},i=e.controls?await Y(e.controls,a,this.readyAttempts):null,s=i?i.params:{},c=i?i.controls:null,u={window,document},l={params:s,controls:c,container:o.element,environment:u,metadata:e.metadata,rendererOptions:e.rendererOptions||{},sendMessage:(h,f)=>this.sendMessage(h,f),onMessage:(h,f)=>this.onMessage(h,f)};if(a.current=l,n&&typeof n.prepare==="function")await n.prepare(e.rendererOptions);let d=null;if(n)d=await n.mount({...l,options:e.rendererOptions||{}})||null;if(this.activeSession){if(this.activeSession.rendererSession?.destroy?.(),this.activeSession.controlRuntime?.destroy(),this.activeSession.createdInternally)this.activeSession.container.remove()}let p={container:o.element,createdInternally:o.createdInternally,controlRuntime:i,rendererSession:d,context:l};return this.activeSession=p,this.sendMessage("ready",{params:s,metadata:e.metadata||null,renderer:t||null}),{params:s,controls:c,container:o.element,metadata:e.metadata,destroy:()=>this.destroyActiveSession(p),update:d?.update?.bind(d),getInstance:d?.getInstance?.bind(d)}}destroyActiveSession(e){if(e.rendererSession?.destroy?.(),e.controlRuntime?.destroy(),e.createdInternally)e.container.remove();if(this.activeSession===e)this.activeSession=null}emitLocal(e,t){let n=this.listeners.get(e);if(!n)return;n.forEach((r)=>{try{r(t)}catch(o){console.error("[hyper-frame] Error in message handler:",o)}})}handleIncomingMessage(e){if(!e||typeof e!=="object")return;let t=e;if(t.source&&t.source!=="hypertool-studio"&&t.source!=="hyperframe-host")return;if(!t.type)return;this.emitLocal(t.type,t.payload)}}function O(e={}){return new v(e)}function Z(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window.p5;if(typeof e!=="function")throw new Error("[hyper-frame] p5 constructor not found on window. Ensure p5 is loaded before hyper-frame.");return e}function x(e,t){if(typeof document==="undefined")throw new Error("mountP5Sketch cannot run outside a browser environment");let n=t||{},r={...e},o=g({target:n.target,className:n.className||n.containerClassName}),a=o.element,i=o.createdInternally,s=null;function c(h){if(s=h,j(h,r),n.onReady)n.onReady({p5:h,container:a})}let l=new(Z())(c,a);if(!s)s=l;function d(h){if(!s)return;j(s,h)}function p(){if(s)s.remove(),s=null;if(i)a.remove()}return{container:a,getInstance:()=>s,setHandlers:d,destroy:p}}function j(e,t){Object.keys(t).forEach((n)=>{let r=t[n];if(typeof r==="function")e[n]=function o(...a){return r(e,...a)}})}function ee(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window;if(!e.hypertoolControls)throw new Error("[hyper-frame] hypertool controls are not available on window");return e.hypertoolControls}function P(e,t,n){let r={};return Object.entries(e).forEach(([o,a])=>{if(typeof a==="function")r[o]=function i(s,...c){return n(s),a(s,t,...c)}}),r}function E(e){let t=e.controls||{},n,r,o=!1;if(e.preconfiguredControls)n=e.preconfiguredControls.params,r=e.preconfiguredControls.controls;else r=ee().createControlPanel(e.controlDefinitions,{title:t.title,position:t.position,expanded:t.expanded,container:t.container,onChange:(d,p)=>{if(typeof t.onChange==="function"){let h={key:p.key,value:p.value,event:p.event};t.onChange(h,a)}}}),n=r.params,o=!0;let a={params:n,controls:r,getP5Instance:()=>i},i=null;function s(l){i=l}let c=x(P(e.handlers,a,s),e.mount);function u(l){c.setHandlers(P(l,a,s))}return{params:n,controls:r,context:a,destroy(){if(c.destroy(),o&&typeof r.destroy==="function")r.destroy()},setHandlers:u,getInstance(){return c.getInstance()}}}function te(e){if(typeof requestAnimationFrame==="function")requestAnimationFrame(e);else setTimeout(e,16)}function ne(e,t,n){return new Promise((r,o)=>{let a=0;function i(){a+=1;try{if(e()){r();return}}catch(s){}if(a>=t){o(new Error(`[hyper-frame] Timed out waiting for ${n}`));return}te(i)}i()})}var re="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js",oe='script[data-hypertool="p5"]';function ae(e,t){if(typeof window==="undefined")return Promise.reject(new Error("[hyper-frame] window is not available"));if(typeof window.p5==="function")return Promise.resolve();return new Promise((n,r)=>{let o=!1;function a(){if(o)return;o=!0,n()}function i(l){if(o)return;o=!0,r(l)}ne(()=>typeof window.p5==="function",t,"p5 constructor").then(a).catch(i);function s(){i(new Error(`[hyper-frame] Failed to load p5 script from ${e}`))}let c=document.querySelector(oe);if(c){c.addEventListener("error",s,{once:!0});return}let u=document.createElement("script");u.src=e,u.async=!0,u.dataset.hypertool="p5",u.addEventListener("error",s,{once:!0}),document.head.appendChild(u)})}async function b(e,t){let n=typeof t.readiness?.maxAttempts==="number"?t.readiness.maxAttempts:600,r=typeof t.p5?.maxAttempts==="number"?t.p5.maxAttempts:n,o=typeof t.p5?.url==="string"&&t.p5.url.trim().length>0?t.p5.url:re;await ae(o,r);let a={current:null},i=t.controlDefinitions,s=t.controls,c=await e.start({renderer:"p5",rendererOptions:{...t,instanceRef:a},controls:i?{definitions:i,options:s?{...s,onChange:s.onChange?(u,l)=>{if(!s.onChange)return;let d={params:l.params,controls:l.controls,getP5Instance:()=>a.current};s.onChange(u,d)}:void 0}:void 0}:null,target:t.mount?.target??null,containerClassName:t.mount?.className||t.mount?.containerClassName,metadata:t.metadata});return{params:c.params,controls:c.controls,context:{params:c.params,controls:c.controls,getP5Instance:()=>c.getInstance?c.getInstance():a.current},destroy:()=>c.destroy(),setHandlers:(u)=>{if(c.update)c.update({type:"handlers",handlers:u})},getInstance:()=>c.getInstance?c.getInstance():a.current}}function I(){return{id:"p5",async mount(e){let t=e.options,n=t.instanceRef||{current:null},r=null,o={params:e.params,controls:e.controls,getP5Instance:()=>r},a=P(t.handlers||{},o,(s)=>{r=s,n.current=s}),i=x(a,{...t.mount||{},target:e.container,className:t.mount?.className||t.mount?.containerClassName||e.container.className,containerClassName:t.mount?.containerClassName,onReady:(s)=>{if(r=s.p5,n.current=s.p5,t.mount?.onReady)t.mount.onReady(s)}});return{destroy:()=>{i.destroy()},update:(s)=>{if(s&&typeof s==="object"&&s.type==="handlers"){let c=s;if(c.handlers)i.setHandlers(P(c.handlers,o,(u)=>{r=u,n.current=u}))}},getInstance:()=>i.getInstance(),setHandlers:(s)=>{i.setHandlers(P(s,o,(c)=>{r=c,n.current=c}))}}}}}function q(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window.THREE;if(typeof e!=="object")throw new Error("[hyper-frame] THREE not found on window. Make sure to import and expose Three.js on window in your sketch.");return e}function w(e,t){if(typeof document==="undefined")throw new Error("mountThreeSketch cannot run outside a browser environment");let n=t||{},r=q(),o=g({target:n.target,className:n.className||n.containerClassName||"hyperframe-three-sketch"}),a=o.element,i=o.createdInternally,s=new r.Scene,c=n.camera||{},u=c.type||"perspective",l;if(u==="perspective")l=new r.PerspectiveCamera(c.fov||75,window.innerWidth/window.innerHeight,c.near||0.1,c.far||1000);else{let m=window.innerWidth/window.innerHeight;l=new r.OrthographicCamera(-m,m,1,-1,c.near||0.1,c.far||1000)}if(c.position)l.position.set(...c.position);else l.position.z=5;let d=n.renderer||{},p=new r.WebGLRenderer({antialias:d.antialias!==!1,alpha:d.alpha||!1,preserveDrawingBuffer:d.preserveDrawingBuffer||!1});p.setSize(a.clientWidth||window.innerWidth,a.clientHeight||window.innerHeight),p.setPixelRatio(window.devicePixelRatio),a.appendChild(p.domElement);let h=null;if(n.orbitControls){let m=window.OrbitControls||r.OrbitControls;if(m)h=new m(l,p.domElement);else console.warn("[hyper-frame] OrbitControls not found. Make sure to import and expose it on window.")}let f={scene:s,camera:l,renderer:p,controls:h},S=null,T=!1,y={...e},k={params:{},controls:null,getThreeContext:()=>f};function A(){let m=a.clientWidth||window.innerWidth,M=a.clientHeight||window.innerHeight;if(l instanceof r.PerspectiveCamera)l.aspect=m/M,l.updateProjectionMatrix();else if(l instanceof r.OrthographicCamera){let _=m/M;l.left=-_,l.right=_,l.updateProjectionMatrix()}if(p.setSize(m,M),y.resize)y.resize(f,k)}function N(){if(!T)return;if(S=requestAnimationFrame(N),y.animate)y.animate(f,k);p.render(s,l)}function W(){if(T)return;T=!0,N()}function z(){if(T=!1,S!==null)cancelAnimationFrame(S),S=null}if(window.addEventListener("resize",A),y.setup)y.setup(f,k);if(W(),n.onReady)n.onReady(f);return{container:a,getContext:()=>f,destroy(){if(z(),window.removeEventListener("resize",A),y.dispose)y.dispose();if(h)h.dispose();if(p.dispose(),a.removeChild(p.domElement),i)a.remove()},startAnimation:W,stopAnimation:z,setHandlers(m){y={...m}}}}function se(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window;if(!e.hypertoolControls)throw new Error("[hyper-frame] hypertool controls are not available on window");return e.hypertoolControls}function L(e){let t=e.controls||{},n={},r,o=!1;if(e.preconfiguredControls)n=e.preconfiguredControls.params,r=e.preconfiguredControls.controls;else r=se().createControlPanel(e.controlDefinitions,{title:t.title,position:t.position,expanded:t.expanded,container:t.container,onChange:(u,l)=>{if(i.params=u,typeof t.onChange==="function"){let d={key:l.key,value:l.value,event:l.event};t.onChange(d,i)}}}),n=r.params,o=!0;let a=null,i={params:n,controls:r,getThreeContext:()=>a?a.getContext():null},s={setup:e.handlers.setup?(c,u)=>e.handlers.setup(c,i):void 0,animate:e.handlers.animate?(c,u)=>e.handlers.animate(c,i):void 0,resize:e.handlers.resize?(c,u)=>e.handlers.resize(c,i):void 0,dispose:e.handlers.dispose};return a=w(s,e.mount),{params:n,controls:r,context:i,threeContext:a.getContext(),destroy(){if(a?.destroy(),o&&typeof r.destroy==="function")r.destroy()},getInstance(){return a?a.getContext():null}}}function ie(e){if(typeof requestAnimationFrame==="function")requestAnimationFrame(e);else setTimeout(e,16)}function ce(e,t,n){return new Promise((r,o)=>{let a=0;function i(){a+=1;try{if(e()){r();return}}catch(s){}if(a>=t){o(new Error(`[hyper-frame] Timed out waiting for ${n}`));return}ie(i)}i()})}function le(e){return ce(()=>{try{return q(),!0}catch(t){return!1}},e,"THREE constructor")}async function D(e,t){let n=typeof t.readiness?.maxAttempts==="number"?t.readiness.maxAttempts:600;await le(n);let r={current:null},o=await e.start({renderer:"three",rendererOptions:{...t,threeContextRef:r},controls:t.controlDefinitions?{definitions:t.controlDefinitions,options:t.controls?{...t.controls,onChange:t.controls.onChange?(a,i)=>{if(!t.controls?.onChange)return;let s={params:i.params,controls:i.controls,getThreeContext:()=>r.current};t.controls.onChange(a,s)}:void 0}:void 0}:null,target:t.mount?.target??null,containerClassName:t.mount?.className||t.mount?.containerClassName,metadata:t.metadata});return{params:o.params,controls:o.controls,context:{params:o.params,controls:o.controls,getThreeContext:()=>o.getInstance?o.getInstance():r.current},threeContext:o.getInstance?o.getInstance():r.current,destroy:()=>o.destroy(),getInstance:()=>o.getInstance?o.getInstance():r.current}}function F(){return{id:"three",async mount(e){let t=e.options,n=t.threeContextRef||{current:null},r=null,o={params:e.params,controls:e.controls,getThreeContext:()=>r?r.getContext():null},a={setup:t.handlers.setup?(i,s)=>t.handlers.setup(i,o):void 0,animate:t.handlers.animate?(i,s)=>t.handlers.animate(i,o):void 0,resize:t.handlers.resize?(i,s)=>t.handlers.resize(i,o):void 0,dispose:t.handlers.dispose};return r=w(a,{...t.mount||{},target:e.container,className:t.mount?.className||t.mount?.containerClassName||e.container.className,containerClassName:t.mount?.containerClassName,onReady:(i)=>{if(n.current=i,t.mount?.onReady)t.mount.onReady(i)}}),n.current=r.getContext(),{destroy:()=>{r?.destroy()},update:(i)=>{if(i&&typeof i==="object"&&i.type==="handlers"){let c=i.handlers;if(c){let u={setup:c.setup?(l,d)=>c.setup(l,o):t.handlers.setup?(l,d)=>t.handlers.setup(l,o):void 0,animate:c.animate?(l,d)=>c.animate(l,o):t.handlers.animate?(l,d)=>t.handlers.animate(l,o):void 0,resize:c.resize?(l,d)=>c.resize(l,o):t.handlers.resize?(l,d)=>t.handlers.resize(l,o):void 0,dispose:c.dispose||t.handlers.dispose};r?.setHandlers(u)}}},getInstance:()=>r?r.getContext():null}}}}var C=O();C.registerRenderer(I());C.registerRenderer(F());var ue=C;function $(e){return C.start(e)}async function U(e){return b(C,e)}async function G(e){return D(C,e)}if(typeof window!=="undefined"){let e=window,t=e.hyperFrame||{};e.hyperFrame={...t,start:$,registerRenderer:(n)=>{C.registerRenderer(n)},syncParentStyles:()=>C.syncParentStyles(!0),p5:{...t.p5||{},mount:x,run:E,start:(n)=>U(n)},three:{...t.three||{},mount:w,run:L,start:(n)=>G(n)}}}export{H as syncParentStyles,D as startThreeSketchWithRuntime,G as startThreeSketch,b as startP5SketchWithRuntime,U as startP5Sketch,$ as startHyperFrame,L as runThreeSketch,E as runP5Sketch,w as mountThreeSketch,x as mountP5Sketch,ue as hyperFrameRuntime,F as createThreeRenderer,I as createP5Renderer,O as createHyperFrameRuntime,R as ParentStyleMirror,v as HyperFrameRuntime};

//# debugId=0919B84E270A19B064756E2164756E21
