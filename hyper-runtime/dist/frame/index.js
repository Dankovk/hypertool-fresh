var L=Object.defineProperty;var D=(e,t)=>{for(var r in t)L(e,r,{get:t[r],enumerable:!0,configurable:!0,set:(n)=>t[r]=()=>n})};var W={};D(W,{startInline:()=>N,start:()=>x,runtime:()=>p,registerAdapter:()=>P,mirrorCss:()=>M,inlineAdapter:()=>u,ensureDependencies:()=>B,attachToWindow:()=>A});var f=new Set(["STYLE","LINK"]);class g{source;target;observer=null;nodeMap=new WeakMap;active=!1;constructor(e={}){this.source=e.sourceDocument??(typeof window!=="undefined"?window.parent?.document??null:null),this.target=e.targetDocument??(typeof document!=="undefined"?document:null),this.active=Boolean(e.mirror??!0)}start(){if(!this.active)return;if(!this.source||!this.target){console.warn("[hyper-frame] Unable to mirror CSS â€“ missing source or target document.");return}this.cleanupPreviousClones(),this.syncAll(),this.attachObserver()}stop(){this.observer?.disconnect(),this.observer=null,this.nodeMap=new WeakMap,this.cleanupPreviousClones()}cleanupPreviousClones(){if(!this.target)return;this.target.querySelectorAll('[data-hyper-frame-clone="true"]').forEach((e)=>e.parentNode?.removeChild(e))}syncAll(){if(!this.source||!this.target)return;let e=this.source.head;Array.from(e.children).filter((r)=>f.has(r.nodeName)).forEach((r)=>{let n=this.cloneNode(r);if(!n)return;this.target?.head.appendChild(n),this.nodeMap.set(r,n)})}attachObserver(){if(!this.source||!this.target)return;if(this.observer)return;this.observer=new MutationObserver((e)=>{e.forEach((t)=>{switch(t.type){case"childList":this.handleChildListMutation(t);break;case"characterData":this.handleCharacterDataMutation(t);break;case"attributes":this.handleAttributeMutation(t);break}})}),this.observer.observe(this.source.head,{childList:!0,subtree:!0,characterData:!0,attributes:!0})}handleChildListMutation(e){if(!this.target)return;e.removedNodes.forEach((t)=>{let r=this.nodeMap.get(t);if(r&&r.parentNode)r.parentNode.removeChild(r),this.nodeMap.delete(t)}),e.addedNodes.forEach((t)=>{if(!(t instanceof HTMLElement))return;if(!f.has(t.nodeName))return;let r=this.cloneNode(t);if(!r)return;let n=e.nextSibling?this.nodeMap.get(e.nextSibling):null;if(n&&n.parentNode)n.parentNode.insertBefore(r,n);else this.target?.head.appendChild(r);this.nodeMap.set(t,r)})}handleCharacterDataMutation(e){let r=e.target.parentNode;if(!r)return;let n=this.nodeMap.get(r);if(!n)return;n.textContent=r.textContent}handleAttributeMutation(e){let t=e.target,r=this.nodeMap.get(t);if(!r||!(r instanceof Element))return;if(e.attributeName){let n=t.getAttribute(e.attributeName);if(n===null)r.removeAttribute(e.attributeName);else r.setAttribute(e.attributeName,n)}}cloneNode(e){if(!(e instanceof HTMLElement))return null;if(!f.has(e.nodeName))return null;let t=e.cloneNode(!0);return t.setAttribute("data-hyper-frame-clone","true"),t}}class y{pending=new Map;ensure(e){let t=this.createKey(e);if(this.pending.has(t))return this.pending.get(t);let r=this.load(e);return this.pending.set(t,r),r}async ensureAll(e=[]){for(let t of e)await this.ensure(t)}createKey(e){return`${e.type}:${e.url}`}load(e){switch(e.type){case"script":return this.injectScript(e);case"style":return this.injectStyle(e);default:return Promise.reject(new Error(`[hyper-frame] Unsupported dependency type: ${e.type}`))}}injectScript(e){if(typeof document==="undefined")return Promise.reject(new Error("[hyper-frame] document is not available"));if(Array.from(document.querySelectorAll("script")).find((r)=>r.src===e.url))return Promise.resolve();return new Promise((r,n)=>{let i=document.createElement("script");if(i.src=e.url,i.async=!0,i.dataset.hyperFrame="external",e.integrity)i.integrity=e.integrity;if(e.crossOrigin)i.crossOrigin=e.crossOrigin;if(e.attributes)Object.entries(e.attributes).forEach(([o,l])=>{i.setAttribute(o,l)});i.addEventListener("load",()=>r(),{once:!0}),i.addEventListener("error",()=>n(new Error(`[hyper-frame] Failed to load script ${e.url}`)),{once:!0}),document.head.appendChild(i)})}injectStyle(e){if(typeof document==="undefined")return Promise.reject(new Error("[hyper-frame] document is not available"));if(Array.from(document.querySelectorAll('link[rel="stylesheet"]')).find((r)=>r.href===e.url))return Promise.resolve();return new Promise((r,n)=>{let i=document.createElement("link");if(i.rel="stylesheet",i.href=e.url,i.dataset.hyperFrame="external",e.attributes)Object.entries(e.attributes).forEach(([o,l])=>{i.setAttribute(o,l)});i.addEventListener("load",()=>r(),{once:!0}),i.addEventListener("error",()=>n(new Error(`[hyper-frame] Failed to load stylesheet ${e.url}`)),{once:!0}),document.head.appendChild(i)})}}class v{controlsApi;constructor(){this.controlsApi=this.resolveControlsApi()}resolveControlsApi(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window;if(!e.hypertoolControls)throw new Error("[hyper-frame] hypertool controls are not available on window");return e.hypertoolControls}init(e){let t=e.options||{};return this.controlsApi.createControlPanel(e.definitions,{title:t.title,position:t.position,expanded:t.expanded,container:t.container,onChange:(n,i)=>{let o={key:i.key,value:i.value,event:i.event};if(e.onControlChange?.(o),typeof t.onChange==="function")t.onChange(o,e.context)}})}}var s={position:"bottom-right",image:{enabled:!0,fileName:"hyperframe-capture.png"},video:{enabled:!0,fileName:"hyperframe-recording.webm",mimeType:"video/webm",bitsPerSecond:4000000,frameRate:60},autoDownload:!0};class b{provider=null;container=null;widget=null;imageButton=null;videoButton=null;options=s;recording=!1;mediaRecorder=null;recordingChunks=[];restorePosition=null;init({container:e,options:t,provider:r}){return this.container=e,this.options=F(t),this.provider=r??null,this.mountWidget(),this.updateButtons(),{captureImage:()=>this.captureImage(),startRecording:()=>this.startRecording(),stopRecording:()=>this.stopRecording(),isRecording:()=>this.recording,destroy:()=>this.destroy()}}setProvider(e){this.provider=e,this.updateButtons()}destroy(){if(this.videoButton?.removeEventListener("click",this.handleVideoClick),this.imageButton?.removeEventListener("click",this.handleImageClick),this.widget&&this.widget.parentElement)this.widget.parentElement.removeChild(this.widget);if(this.container&&this.restorePosition!==null)this.container.style.position=this.restorePosition;this.widget=null,this.imageButton=null,this.videoButton=null,this.container=null,this.restorePosition=null,this.provider=null,this.recording=!1,this.teardownMediaRecorder()}mountWidget(){if(!this.container)return;if(window.getComputedStyle(this.container).position==="static")this.restorePosition=this.container.style.position,this.container.style.position="relative";this.widget=document.createElement("div"),this.widget.className="hyperframe-export-widget",Object.assign(this.widget.style,{position:"absolute",zIndex:"2147483646",display:"flex",flexDirection:"column",gap:"8px",padding:"12px",borderRadius:"12px",background:"rgba(17, 24, 39, 0.75)",backdropFilter:"blur(12px)",color:"white",fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',fontSize:"12px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.25)",pointerEvents:"auto"});let{x:t,y:r}=T(this.options.position);Object.assign(this.widget.style,t),Object.assign(this.widget.style,r),this.imageButton=this.createButton("Capture PNG"),this.imageButton.addEventListener("click",this.handleImageClick),this.widget.appendChild(this.imageButton),this.videoButton=this.createButton("Start Recording"),this.videoButton.addEventListener("click",this.handleVideoClick),this.widget.appendChild(this.videoButton),this.container.appendChild(this.widget)}createButton(e){let t=document.createElement("button");return t.type="button",t.textContent=e,Object.assign(t.style,{appearance:"none",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",padding:"8px 12px",background:"rgba(255, 255, 255, 0.12)",color:"white",fontWeight:500,cursor:"pointer",transition:"background 120ms ease, border 120ms ease, transform 120ms ease"}),t.onmouseenter=()=>{t.style.background="rgba(255, 255, 255, 0.2)",t.style.border="1px solid rgba(255, 255, 255, 0.3)"},t.onmouseleave=()=>{t.style.background="rgba(255, 255, 255, 0.12)",t.style.border="1px solid rgba(255, 255, 255, 0.2)",t.style.transform="none"},t.onmousedown=()=>{t.style.transform="scale(0.97)"},t.onmouseup=()=>{t.style.transform="none"},t}handleImageClick=async()=>{let e=await this.captureImage();if(e&&this.options.autoDownload)R({blob:e,fileName:this.options.image.fileName})};handleVideoClick=async()=>{if(this.recording){let e=await this.stopRecording();if(e&&this.options.autoDownload)R({blob:e,fileName:this.options.video.fileName});return}await this.startRecording()};async captureImage(){if(!this.options.image.enabled)return null;if(this.provider?.captureFrame){let e=await this.provider.captureFrame();return E(e)}return this.captureFromCanvas()}async startRecording(){if(!this.options.video.enabled)return null;if(this.recording)return null;if(this.provider?.startRecording)return await this.provider.startRecording({mimeType:this.options.video.mimeType,bitsPerSecond:this.options.video.bitsPerSecond,frameRate:this.options.video.frameRate}),this.recording=!0,this.updateButtons(),null;let e=this.findCanvas();if(!e||typeof e.captureStream!=="function")return console.warn("[hyper-frame] Unable to start recording: canvas captureStream not available."),null;let t=e.captureStream(this.options.video.frameRate);try{this.mediaRecorder=new MediaRecorder(t,{mimeType:this.options.video.mimeType,videoBitsPerSecond:this.options.video.bitsPerSecond})}catch(r){return console.warn("[hyper-frame] Unable to create MediaRecorder:",r),null}return this.recordingChunks=[],this.mediaRecorder.ondataavailable=(r)=>{if(r.data.size>0)this.recordingChunks.push(r.data)},this.mediaRecorder.onstop=()=>{this.recording=!1,this.updateButtons()},this.mediaRecorder.start(),this.recording=!0,this.updateButtons(),null}async stopRecording(){if(!this.recording)return null;if(this.provider?.stopRecording){let r=await this.provider.stopRecording();return this.recording=this.provider.isRecording?.()??!1,this.updateButtons(),r?E(r):null}if(!this.mediaRecorder)return null;let e=this.mediaRecorder,t=new Promise((r)=>{e.onstop=()=>{let n=new Blob(this.recordingChunks,{type:this.options.video.mimeType});this.recording=!1,this.teardownMediaRecorder(),this.updateButtons(),r(n)}});return e.stop(),t}captureFromCanvas(){let e=this.findCanvas();if(!e)return console.warn("[hyper-frame] No canvas element found for PNG capture."),null;try{let t=e.toDataURL("image/png");return H(t)}catch(t){return console.warn("[hyper-frame] Failed to capture canvas frame:",t),null}}findCanvas(){if(!this.container)return null;return this.container.querySelector("canvas")}teardownMediaRecorder(){if(this.mediaRecorder)this.mediaRecorder.ondataavailable=null,this.mediaRecorder.onstop=null,this.mediaRecorder=null;this.recordingChunks=[]}updateButtons(){let e=this.options.image.enabled&&(this.provider?.captureFrame||this.findCanvas());if(this.imageButton)this.imageButton.disabled=!e,this.imageButton.style.opacity=e?"1":"0.5",this.imageButton.style.cursor=e?"pointer":"not-allowed";let t=this.options.video.enabled&&(this.provider?.startRecording||this.findCanvas()&&typeof MediaRecorder!=="undefined");if(this.videoButton)this.videoButton.disabled=!t,this.videoButton.textContent=this.recording?"Stop Recording":"Start Recording",this.videoButton.style.opacity=t?"1":"0.5",this.videoButton.style.cursor=t?"pointer":"not-allowed"}}function F(e){return{position:e?.position??s.position,image:{enabled:e?.image?.enabled??s.image.enabled,fileName:e?.image?.fileName??s.image.fileName},video:{enabled:e?.video?.enabled??s.video.enabled,fileName:e?.video?.fileName??s.video.fileName,mimeType:e?.video?.mimeType??s.video.mimeType,bitsPerSecond:e?.video?.bitsPerSecond??s.video.bitsPerSecond,frameRate:e?.video?.frameRate??s.video.frameRate},autoDownload:e?.autoDownload??s.autoDownload}}function E(e){if(e instanceof Blob)return e;if(typeof e==="string"){if(e.startsWith("data:"))return H(e);return new Blob([e],{type:"text/plain"})}throw new Error("[hyper-frame] Unsupported capture result type.")}function H(e){let[t,r]=e.split(","),n=t.match(/data:(.*);base64/),i=n?n[1]:"application/octet-stream",o=atob(r),l=o.length,m=new Uint8Array(l);for(let d=0;d<l;d+=1)m[d]=o.charCodeAt(d);return new Blob([m],{type:i})}function R({blob:e,fileName:t}){let r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function T(e){switch(e){case"top-left":return{x:{left:"16px"},y:{top:"16px"}};case"top-right":return{x:{right:"16px"},y:{top:"16px"}};case"bottom-left":return{x:{left:"16px"},y:{bottom:"16px"}};case"bottom-right":default:return{x:{right:"16px"},y:{bottom:"16px"}}}}function O(e={}){let t=e.documentRef??document;if(!t)throw new Error("[hyper-frame] document is not available");let r=e.containerClassName||"hypertool-sketch",n=e.target;if(n instanceof HTMLElement)return n.classList.add(r),{element:n,createdInternally:!1};if(typeof n==="string"&&n.trim().length>0){let o=t.querySelector(n);if(o)return o.classList.add(r),{element:o,createdInternally:!1};console.warn(`[hyper-frame] Could not find container for selector "${n}", creating one instead.`)}let i=t.createElement("div");return i.classList.add(r),t.body.appendChild(i),{element:i,createdInternally:!0}}class C{adapters=new Map;dependencyManager=new y;cssBridge=null;config;constructor(e={}){this.config=e}registerAdapter(e){this.adapters.set(e.id,e)}async ensureDependencies(e){if(!e||e.length===0)return;await this.dependencyManager.ensureAll(e)}mirrorCss(){if(this.cssBridge)return;this.cssBridge=new g({mirror:this.config.mirrorCss!==!1}),this.cssBridge.start()}async start(e){let t=this.resolveAdapter(e.adapter);if(e.dependencies?.length)await this.ensureDependencies(e.dependencies);if(this.config.mirrorCss!==!1&&e.mirrorCss!==!1)this.mirrorCss();if(typeof t.ensure==="function")await t.ensure(e.options,this);let r=this.createMount(e.mount),n={params:{},controls:null,getInstance:()=>null},i=this.createControls(e.controlDefinitions,e.controls,n),o=i?.params??{};n.params=o,n.controls=i;let l=null,d=this.config.exportWidget!==!1&&e.exporter!==!1?new b:null,h=null,w=(c)=>{l=c,d?.setProvider(c)},S={mount:{container:r.container,destroy:()=>r.destroy()},controls:i,params:o,runtime:this,mountOptions:e.mount,registerExportProvider:w},a=await t.start(e.options,S);if(a.exports)w(a.exports);if(d){let c=typeof e.exporter==="object"?e.exporter:void 0;h=d.init({container:r.container,options:c,provider:l})}if(a.getInstance)n.getInstance=()=>a.getInstance();return{destroy:()=>{if(a.destroy(),r.destroy(),i){if(typeof i.destroy==="function")i.destroy();else if(typeof i.dispose==="function")i.dispose()}h?.destroy()},setHandlers:a.setHandlers?(c)=>a.setHandlers(c):void 0,getInstance:a.getInstance?()=>a.getInstance():void 0,params:o,controls:i,container:r.container,exporter:h,exports:a.exports}}resolveAdapter(e){if(typeof e!=="string")return e;let t=this.adapters.get(e);if(!t)throw new Error(`[hyper-frame] Adapter "${e}" is not registered`);return t}createMount(e){let t=e?{target:e.target,containerClassName:e.containerClassName,onReady:e.onReady}:void 0,r=O(t);if(t?.onReady)t.onReady({container:r.element});return{container:r.element,destroy:()=>{if(r.createdInternally)r.element.remove()}}}createControls(e,t,r){if(!e)return null;return new v().init({definitions:e,options:t,context:r,onControlChange:()=>{}})}}var u={id:"inline",async start(e,t){let r=await e?.setup?.(I(t))||{};if(r.exports)t.registerExportProvider?.(r.exports);return k(r)}};function I(e){return{container:e.mount.container,controls:e.controls,params:e.params,runtime:e.runtime,mountOptions:e.mountOptions,registerExports(t){e.registerExportProvider?.(t)}}}function k(e){return{destroy:e.destroy?.bind(e)??(()=>{}),setHandlers:e.setHandlers?.bind(e),getInstance:e.getInstance?.bind(e),exports:e.exports??null}}var p=new C({mirrorCss:!0,exportWidget:!0});p.registerAdapter(u);function P(e){p.registerAdapter(e)}function x(e){return p.start(e)}function B(e){return p.ensureDependencies(e)}function M(){p.mirrorCss()}function N(e={}){let{setup:t,...r}=e;return x({...r,adapter:u,options:{setup:t}})}function A(){if(typeof window==="undefined")return;let e=window,t={version:"next",runtime:p,registerAdapter:P,ensureDependencies:B,mirrorCss:M,start:x,inline:{adapter:u,start:N}};e.hyperFrame={...e.hyperFrame||{},...t}}A();export{N as startInline,x as start,p as runtime,P as registerAdapter,M as mirrorCss,u as inlineAdapter,B as ensureDependencies,A as attachToWindow};

//# debugId=6E1B1E2C40EA1DDB64756E2164756E21
