var Q=Object.defineProperty;var V=(e,t)=>{for(var r in t)Q(e,r,{get:t[r],enumerable:!0,configurable:!0,set:(n)=>t[r]=()=>n})};var oe={};V(oe,{threeAdapter:()=>R,startThreeSketch:()=>$,startP5Sketch:()=>U,start:()=>F,runtime:()=>c,runThreeSketch:()=>_,runP5Sketch:()=>B,registerAdapter:()=>D,p5Adapter:()=>k,mountThreeSketch:()=>z,mountP5Sketch:()=>W,mirrorCss:()=>j,ensureDependencies:()=>I,attachToWindow:()=>q});var C=new Set(["STYLE","LINK"]);class P{source;target;observer=null;nodeMap=new WeakMap;active=!1;constructor(e={}){this.source=e.sourceDocument??(typeof window!=="undefined"?window.parent?.document??null:null),this.target=e.targetDocument??(typeof document!=="undefined"?document:null),this.active=Boolean(e.mirror??!0)}start(){if(!this.active)return;if(!this.source||!this.target){console.warn("[hyper-frame] Unable to mirror CSS â€“ missing source or target document.");return}this.cleanupPreviousClones(),this.syncAll(),this.attachObserver()}stop(){this.observer?.disconnect(),this.observer=null,this.nodeMap=new WeakMap,this.cleanupPreviousClones()}cleanupPreviousClones(){if(!this.target)return;this.target.querySelectorAll('[data-hyper-frame-clone="true"]').forEach((e)=>e.parentNode?.removeChild(e))}syncAll(){if(!this.source||!this.target)return;let e=this.source.head;Array.from(e.children).filter((r)=>C.has(r.nodeName)).forEach((r)=>{let n=this.cloneNode(r);if(!n)return;this.target?.head.appendChild(n),this.nodeMap.set(r,n)})}attachObserver(){if(!this.source||!this.target)return;if(this.observer)return;this.observer=new MutationObserver((e)=>{e.forEach((t)=>{switch(t.type){case"childList":this.handleChildListMutation(t);break;case"characterData":this.handleCharacterDataMutation(t);break;case"attributes":this.handleAttributeMutation(t);break}})}),this.observer.observe(this.source.head,{childList:!0,subtree:!0,characterData:!0,attributes:!0})}handleChildListMutation(e){if(!this.target)return;e.removedNodes.forEach((t)=>{let r=this.nodeMap.get(t);if(r&&r.parentNode)r.parentNode.removeChild(r),this.nodeMap.delete(t)}),e.addedNodes.forEach((t)=>{if(!(t instanceof HTMLElement))return;if(!C.has(t.nodeName))return;let r=this.cloneNode(t);if(!r)return;let n=e.nextSibling?this.nodeMap.get(e.nextSibling):null;if(n&&n.parentNode)n.parentNode.insertBefore(r,n);else this.target?.head.appendChild(r);this.nodeMap.set(t,r)})}handleCharacterDataMutation(e){let r=e.target.parentNode;if(!r)return;let n=this.nodeMap.get(r);if(!n)return;n.textContent=r.textContent}handleAttributeMutation(e){let t=e.target,r=this.nodeMap.get(t);if(!r||!(r instanceof Element))return;if(e.attributeName){let n=t.getAttribute(e.attributeName);if(n===null)r.removeAttribute(e.attributeName);else r.setAttribute(e.attributeName,n)}}cloneNode(e){if(!(e instanceof HTMLElement))return null;if(!C.has(e.nodeName))return null;let t=e.cloneNode(!0);return t.setAttribute("data-hyper-frame-clone","true"),t}}class E{pending=new Map;ensure(e){let t=this.createKey(e);if(this.pending.has(t))return this.pending.get(t);let r=this.load(e);return this.pending.set(t,r),r}async ensureAll(e=[]){for(let t of e)await this.ensure(t)}createKey(e){return`${e.type}:${e.url}`}load(e){switch(e.type){case"script":return this.injectScript(e);case"style":return this.injectStyle(e);default:return Promise.reject(new Error(`[hyper-frame] Unsupported dependency type: ${e.type}`))}}injectScript(e){if(typeof document==="undefined")return Promise.reject(new Error("[hyper-frame] document is not available"));if(Array.from(document.querySelectorAll("script")).find((r)=>r.src===e.url))return Promise.resolve();return new Promise((r,n)=>{let o=document.createElement("script");if(o.src=e.url,o.async=!0,o.dataset.hyperFrame="external",e.integrity)o.integrity=e.integrity;if(e.crossOrigin)o.crossOrigin=e.crossOrigin;if(e.attributes)Object.entries(e.attributes).forEach(([i,a])=>{o.setAttribute(i,a)});o.addEventListener("load",()=>r(),{once:!0}),o.addEventListener("error",()=>n(new Error(`[hyper-frame] Failed to load script ${e.url}`)),{once:!0}),document.head.appendChild(o)})}injectStyle(e){if(typeof document==="undefined")return Promise.reject(new Error("[hyper-frame] document is not available"));if(Array.from(document.querySelectorAll('link[rel="stylesheet"]')).find((r)=>r.href===e.url))return Promise.resolve();return new Promise((r,n)=>{let o=document.createElement("link");if(o.rel="stylesheet",o.href=e.url,o.dataset.hyperFrame="external",e.attributes)Object.entries(e.attributes).forEach(([i,a])=>{o.setAttribute(i,a)});o.addEventListener("load",()=>r(),{once:!0}),o.addEventListener("error",()=>n(new Error(`[hyper-frame] Failed to load stylesheet ${e.url}`)),{once:!0}),document.head.appendChild(o)})}}function x(e={}){let t=e.documentRef??document;if(!t)throw new Error("[hyper-frame] document is not available");let r=e.containerClassName||"hypertool-sketch",n=e.target;if(n instanceof HTMLElement)return n.classList.add(r),{element:n,createdInternally:!1};if(typeof n==="string"&&n.trim().length>0){let i=t.querySelector(n);if(i)return i.classList.add(r),{element:i,createdInternally:!1};console.warn(`[hyper-frame] Could not find container for selector "${n}", creating one instead.`)}let o=t.createElement("div");return o.classList.add(r),t.body.appendChild(o),{element:o,createdInternally:!0}}class S{controlsApi;constructor(){this.controlsApi=this.resolveControlsApi()}resolveControlsApi(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window;if(!e.hypertoolControls)throw new Error("[hyper-frame] hypertool controls are not available on window");return e.hypertoolControls}init(e){let t=e.options||{};return this.controlsApi.createControlPanel(e.definitions,{title:t.title,position:t.position,expanded:t.expanded,container:t.container,onChange:(n,o)=>{if(typeof t.onChange==="function"){let i={key:o.key,value:o.value,event:o.event};e.onControlChange?.(i),t.onChange(i,e.context)}else e.onControlChange?.({key:o.key,value:o.value,event:o.event})}})}}function M(e){let t={};return Object.entries(e).forEach(([r,n])=>{if(typeof n==="function")t[r]=(o,i,...a)=>{n(o,...a)}}),t}class T{adapters=new Map;dependencyManager=new E;cssBridge=null;config;constructor(e={}){this.config=e}registerAdapter(e){this.adapters.set(e.id,e)}async ensureDependencies(e){if(!e||e.length===0)return;await this.dependencyManager.ensureAll(e)}mirrorCss(){if(this.cssBridge)return;this.cssBridge=new P({mirror:this.config.mirrorCss!==!1}),this.cssBridge.start()}async start(e){let t=this.resolveAdapter(e.adapter);if(e.dependencies?.length)await this.ensureDependencies(e.dependencies);if(this.config.mirrorCss!==!1&&e.mirrorCss!==!1)this.mirrorCss();if(typeof t.ensure==="function")await t.ensure(e.options,this);let r=this.createMount(e.mount),n=new S,o={params:{},controls:null,getInstance:()=>null,getP5Instance:()=>null},i=e.controlDefinitions?n.init({definitions:e.controlDefinitions,options:e.controls,context:o,onControlChange:(s)=>{}}):null,a={mount:{container:r.container,destroy:()=>r.destroy()},controls:i,params:i?.params??{},runtime:this,mountOptions:e.mount},u=await t.start(e.options,a);if(o){o.params=a.params,o.controls=i;let s=()=>u.getInstance?u.getInstance():null;o.getInstance=s,o.getP5Instance=s}return{destroy:()=>{if(u.destroy(),r.destroy(),i){if(typeof i.destroy==="function")i.destroy();else if(typeof i.dispose==="function")i.dispose()}},setHandlers:u.setHandlers?(s)=>u.setHandlers(s):void 0,getInstance:u.getInstance?()=>u.getInstance():void 0,params:a.params,controls:i,container:r.container}}resolveAdapter(e){if(typeof e!=="string")return e;let t=this.adapters.get(e);if(!t)throw new Error(`[hyper-frame] Adapter "${e}" is not registered`);return t}createMount(e){let t=e?{target:e.target,containerClassName:e.containerClassName,onReady:e.onReady}:void 0,r=x(t);if(t?.onReady)t.onReady({container:r.element});return{container:r.element,destroy:()=>{if(r.createdInternally)r.element.remove()}}}async runP5Sketch(e){let t=await this.start({adapter:"p5",options:e.handlers,controlDefinitions:e.controlDefinitions,controls:e.controls,mount:e.mount,dependencies:e.dependencies,mirrorCss:e.mirrorCss}),r=t.params??{},n=t.controls;return{params:r,controls:n,context:{params:r,controls:n,getP5Instance:()=>t.getInstance?t.getInstance():null,getInstance:()=>t.getInstance?t.getInstance():null},destroy:()=>t.destroy(),setHandlers:(o)=>t.setHandlers?.(o),getInstance:()=>t.getInstance?t.getInstance():null}}async startP5Sketch(e){let t=[...e.dependencies??[]];if(e.p5?.url)t.unshift({type:"script",url:e.p5.url});return this.runP5Sketch({...e,dependencies:t})}async mountP5Sketch(e,t){let r=await this.start({adapter:"p5",options:M(e),mount:t});return{container:r.container,getInstance:()=>r.getInstance?r.getInstance():null,setHandlers:(n)=>{r.setHandlers?.(M(n))},destroy:()=>r.destroy()}}async runThreeSketch(e){let t=await this.start({adapter:"three",options:e.handlers,controlDefinitions:e.controlDefinitions,controls:e.controls,mount:e.mount,dependencies:e.dependencies,mirrorCss:e.mirrorCss}),r={params:t.params??{},controls:t.controls,getThreeContext:()=>t.getInstance?t.getInstance():null};return{params:t.params??{},controls:t.controls,context:r,destroy:()=>t.destroy(),setHandlers:(n)=>t.setHandlers?.(n),getContext:()=>t.getInstance?t.getInstance():null}}async startThreeSketch(e){let t=[...e.dependencies??[]];if(e.three?.url)t.unshift({type:"script",url:e.three.url});return this.runThreeSketch({...e,dependencies:t})}async mountThreeSketch(e,t){let r=await this.start({adapter:"three",options:e,mount:t});return{container:r.container,getInstance:()=>r.getInstance?r.getInstance():null,setHandlers:(n)=>{r.setHandlers?.(n)},destroy:()=>r.destroy()}}}function X(e){if(typeof requestAnimationFrame==="function")requestAnimationFrame(e);else setTimeout(e,16)}function H(e,t,r){return new Promise((n,o)=>{let i=0;function a(){i+=1;try{if(e()){n();return}}catch(u){}if(i>=t){o(new Error(`[hyper-frame] Timed out waiting for ${r}`));return}X(a)}a()})}var N="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js";function Z(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window.p5;if(typeof e!=="function")throw new Error("[hyper-frame] p5 constructor not found on window. Ensure p5 is loaded before hyper-frame.");return e}function L(e,t){for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let n=t[r];if(typeof n==="function")e[r]=n}}function ee(e,t){let r={};return Object.entries(e).forEach(([n,o])=>{if(typeof o==="function")r[n]=(i,...a)=>{return o(i,t,...a)}}),r}async function te(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");if(typeof window.p5==="function")return;if(typeof document==="undefined")throw new Error("[hyper-frame] document is not available");let e=N;if(Array.from(document.querySelectorAll(`script[src="${e}"]`)).length===0){let r=document.createElement("script");r.src=e,r.async=!0,r.dataset.hyperFrame="p5",document.head.appendChild(r)}await H(()=>typeof window.p5==="function",300,"p5 constructor")}var k={id:"p5",async ensure(e,t){try{await te()}catch(r){await t.ensureDependencies([{type:"script",url:N}]),await H(()=>typeof window.p5==="function",300,"p5 constructor")}},async start(e,t){if(typeof document==="undefined")throw new Error("mountP5Sketch cannot run outside a browser environment");let r=null,n={...e},o={params:t.params,controls:t.controls,getInstance:()=>r,getP5Instance:()=>r},i=()=>ee(n,o);function a(s){r=s,L(s,i())}let m=new(Z())(a,t.mount.container);if(!r)r=m;return{destroy(){if(r)r.remove(),r=null},setHandlers(s){if(n={...s},r)L(r,i())},getInstance(){return r}}}};function re(){if(typeof window==="undefined")throw new Error("[hyper-frame] window is not available");let e=window.THREE;if(typeof e!=="object")throw new Error("[hyper-frame] THREE not found on window. Make sure to import and expose Three.js on window in your sketch.");return e}function ne(e,t){return{params:e.params,controls:e.controls,getThreeContext:()=>t}}var R={id:"three",async start(e,t){if(typeof document==="undefined")throw new Error("mountThreeSketch cannot run outside a browser environment");let r=re(),n=t.mountOptions||{},o=n.camera||{},i=n.renderer||{},a=t.mount.container,u=new r.Scene,m=o.type||"perspective",s;if(m==="perspective")s=new r.PerspectiveCamera(o.fov||75,a.clientWidth/(a.clientHeight||1),o.near||0.1,o.far||1000);else{let l=(a.clientWidth||window.innerWidth)/(a.clientHeight||window.innerHeight||1);s=new r.OrthographicCamera(-l,l,1,-1,o.near||0.1,o.far||1000)}if(o.position)s.position.set(...o.position);else s.position.z=5;let p=new r.WebGLRenderer({antialias:i.antialias!==!1,alpha:Boolean(i.alpha),preserveDrawingBuffer:Boolean(i.preserveDrawingBuffer)}),K=a.clientWidth||window.innerWidth,G=a.clientHeight||window.innerHeight;p.setSize(K,G),p.setPixelRatio(window.devicePixelRatio),a.appendChild(p.domElement);let f=null;if(n.orbitControls){let l=window.OrbitControls||r.OrbitControls;if(l)f=new l(s,p.domElement);else console.warn("[hyper-frame] OrbitControls not found. Make sure to import and expose it on window.")}let d={scene:u,camera:s,renderer:p,controls:f||void 0},h={...e},y=null,w=!1,g=ne(t,d);function A(){let l=a.clientWidth||window.innerWidth,v=a.clientHeight||window.innerHeight;if(s instanceof r.PerspectiveCamera)s.aspect=l/v,s.updateProjectionMatrix();else if(s instanceof r.OrthographicCamera){let O=l/v;s.left=-O,s.right=O,s.updateProjectionMatrix()}p.setSize(l,v),h.resize?.(d,g)}window.addEventListener("resize",A);function b(){if(!w)return;if(y=requestAnimationFrame(b),f&&typeof f.update==="function")f.update();h.animate?.(d,g),p.render(u,s)}if(h.setup?.(d,g),typeof n.onReady==="function")n.onReady(d);function Y(){if(!w)w=!0,b()}function J(){if(w=!1,y!==null)cancelAnimationFrame(y),y=null}return Y(),{destroy(){if(J(),window.removeEventListener("resize",A),h.dispose?.(),f&&typeof f.dispose==="function")f.dispose();if(p.dispose(),p.domElement.parentNode===a)a.removeChild(p.domElement)},setHandlers(l){h={...l}},getInstance(){return d}}}};var c=new T({mirrorCss:!0});c.registerAdapter(k);c.registerAdapter(R);function D(e){c.registerAdapter(e)}function F(e){return c.start(e)}function I(e){return c.ensureDependencies(e)}function j(){c.mirrorCss()}function W(e,t){return c.mountP5Sketch(e,t)}function B(e){return c.runP5Sketch(e)}function U(e){return c.startP5Sketch(e)}function _(e){return c.runThreeSketch(e)}function $(e){return c.startThreeSketch(e)}function z(e,t){return c.mountThreeSketch(e,t)}function q(){if(typeof window==="undefined")return;let e=window,t={version:"next",runtime:c,registerAdapter:D,ensureDependencies:I,mirrorCss:j,start:F,p5:{mount:W,run:B,start:U},three:{mount:z,run:_,start:$}};e.hyperFrame={...e.hyperFrame||{},...t}}q();export{R as threeAdapter,$ as startThreeSketch,U as startP5Sketch,F as start,c as runtime,_ as runThreeSketch,B as runP5Sketch,D as registerAdapter,k as p5Adapter,z as mountThreeSketch,W as mountP5Sketch,j as mirrorCss,I as ensureDependencies,q as attachToWindow};

//# debugId=FBAF976A877B3C6864756E2164756E21
